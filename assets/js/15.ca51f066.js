(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{373:function(s,t,a){s.exports=a.p+"assets/img/login.f91c691f.png"},456:function(s,t,a){"use strict";a.r(t);var n=a(11),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"微信登录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微信登录"}},[s._v("#")]),s._v(" 微信登录")]),s._v(" "),n("p",[s._v("#小程序开发指南#\n#微信小程序团队#\n#应用场景#\n#微信登录#\n#微信小程序#")]),s._v(" "),n("p",[s._v("微信小程序 微信登录（获取微信登录凭证 code、发送 code 到开发者服务器、到微信服务器换取微信用户身份 id、绑定微信用户身份 id 和业务用户身份）。")]),s._v(" "),n("ul",[n("li",[s._v("获取微信登录态")]),s._v(" "),n("li",[s._v("打通微信账号与自己的账号")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(373),alt:"微信登录过程"}})]),s._v(" "),n("h2",{attrs:{id:"获取微信登录凭证-code"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取微信登录凭证-code"}},[s._v("#")]),s._v(" 获取微信登录凭证 code")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("wx.login")]),s._v(" 生成5分钟时效性的凭证")]),s._v(" "),n("li",[s._v("后台根据凭证从微信后台服务器获取微信用户 id")])]),s._v(" "),n("h2",{attrs:{id:"发送-code-到开发者服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发送-code-到开发者服务器"}},[s._v("#")]),s._v(" 发送 code 到开发者服务器")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("wx.login")]),s._v(" "),n("code",[s._v("success")]),s._v(" 回调返回微信登录凭证，"),n("code",[s._v("wx.request")]),s._v(" 传微信登录凭证、账号、密码")]),s._v(" "),n("li",[s._v("开发者服务器校验账号密码，和微信用户 id 绑定")])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// page.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Page")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("tapLogin")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    wx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("login")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("success")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("code"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          wx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            url"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://test.com/login'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              username"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangsan'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户输入的账号")]),s._v("\n              password"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pwd123456'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用户输入的密码")]),s._v("\n              code"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("code\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("success")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 登录成功")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("statusCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n               console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sessionId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 服务器回包内容")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'获取用户登录态失败！'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("errMsg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h2",{attrs:{id:"到微信服务器换取微信用户身份-id"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#到微信服务器换取微信用户身份-id"}},[s._v("#")]),s._v(" 到微信服务器换取微信用户身份 id")]),s._v(" "),n("ul",[n("li",[s._v("开发者后台传微信登录凭证 code、AppId、AppSecret 到微信服务器换取微信用户身份")]),s._v(" "),n("li",[s._v("code 成功换取一次信息后立即失效，即便还没过期")]),s._v(" "),n("li",[s._v("微信服务器地址"),n("br"),s._v(" "),n("code",[s._v("https://api.weixin.qq.com/sns/jscode2session?appid=<AppId>&secret=<AppSecret>&js_code=<code>&grant_type=authorization_code")])]),s._v(" "),n("li",[s._v("jscode2session 返回字段")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("字段")]),s._v(" "),n("th",[s._v("描述")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[n("code",[s._v("openid")])]),s._v(" "),n("td",[s._v("微信用户 id 唯一标识")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("session_key")])]),s._v(" "),n("td",[s._v("会话密钥，可以请求微信服务器其他接口获取信息，不应该下放到前端")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("unionid")])]),s._v(" "),n("td",[s._v("用户在微信开放平台的唯一标识符。本字段在满足一定条件的情况下才返回。")])])])]),s._v(" "),n("h2",{attrs:{id:"绑定微信用户身份-id-和业务用户身份"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#绑定微信用户身份-id-和业务用户身份"}},[s._v("#")]),s._v(" 绑定微信用户身份 id 和业务用户身份")]),s._v(" "),n("ul",[n("li",[s._v("开发者后台通过校验用户名密码获得业务侧的用户身份 id，通过 code 到微信服务器获得微信侧的用户身份 openid")]),s._v(" "),n("li",[s._v("把两个信息的对应关系“绑定”保存起来")]),s._v(" "),n("li",[s._v("下次需要用户登录的时候可以不需要输入账号、密码。通过 "),n("code",[s._v("wx.login")]),s._v(" 获得的 code 到微信服务器获得 openid，通过绑定信息获得业务的的用户身份 id")])]),s._v(" "),n("h2",{attrs:{id:"业务登录凭证-sessionid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#业务登录凭证-sessionid"}},[s._v("#")]),s._v(" 业务登录凭证 SessionId")]),s._v(" "),n("ul",[n("li",[s._v("开发者服务器与开发者小程序会话密钥")]),s._v(" "),n("li",[s._v("用户登录成功后开发者服务器生成会话秘钥 SessionId 并返回给小程序")]),s._v(" "),n("li",[s._v("小程序后续发送请求携带 SessionId 开发者服务器可以通过 SessionId 查询到当前登录用户的身份")])])])}),[],!1,null,null,null);t.default=e.exports}}]);